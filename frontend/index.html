<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EcoStarter Token DApp</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .card { border: 1px solid #ccc; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        button { padding: 10px 20px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px; }
        button:hover { background-color: #45a049; }
        input { padding: 8px; width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        #status { margin-top: 10px; color: gray; }
    </style>
</head>
<body>
    <h1>üå± EcoStarter (GPT) Wallet</h1>

    <div class="card">
        <h3>Connection</h3>
        <button id="connectBtn">Connect MetaMask</button>
        <p><strong>Account:</strong> <span id="accountAddress">Not connected</span></p>
        <p><strong>Balance:</strong> <span id="tokenBalance">0</span> GPT</p>
    </div>

    <div class="card">
        <h3>Transfer Tokens</h3>
        <label>Recipient Address:</label>
        <input type="text" id="recipient" placeholder="0x...">
        
        <label>Amount (GPT):</label>
        <input type="number" id="amount" placeholder="10">
        
        <button id="transferBtn" disabled>Send Tokens</button>
        <p id="status"></p>
    </div>

    <script>
        // 1. –ê–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (–∏–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞)
        const CONTRACT_ADDRESS = "0x5FbDB2315678afecb367f032d93F642f64180aa3";

        // 2. ABI - –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ)
        const ABI = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function balanceOf(address) view returns (uint256)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function decimals() view returns (uint8)",
            "event Transfer(address indexed from, address indexed to, uint256 value)"
        ];

        let provider, signer, contract;

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        async function connectWallet() {
            if (window.ethereum) {
                try {
                    // –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    const address = await signer.getAddress();
                    
                    document.getElementById("accountAddress").innerText = address;
                    document.getElementById("connectBtn").innerText = "Connected";
                    document.getElementById("transferBtn").disabled = false;

                    // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
                    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–ª–∞–Ω—Å
                    updateBalance(address);

                    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è (Real-time updates)
                    contract.on("Transfer", (from, to, value) => {
                        if (from === address || to === address) {
                            updateBalance(address);
                            document.getElementById("status").innerText = "Transfer detected! Balance updated.";
                        }
                    });

                } catch (error) {
                    console.error(error);
                    alert("Error connecting wallet!");
                }
            } else {
                alert("Please install MetaMask!");
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        async function updateBalance(address) {
            if (!contract) return;
            const balance = await contract.balanceOf(address);
            const decimals = await contract.decimals();
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–∑ Wei –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –≤–∏–¥ (18 –Ω—É–ª–µ–π)
            const formattedBalance = ethers.formatUnits(balance, decimals);
            document.getElementById("tokenBalance").innerText = formattedBalance;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
        async function transferTokens() {
            const recipient = document.getElementById("recipient").value;
            const amount = document.getElementById("amount").value;
            
            if (!ethers.isAddress(recipient)) {
                alert("Invalid address!");
                return;
            }

            try {
                document.getElementById("status").innerText = "Processing transaction...";
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ –≤ Wei (–¥–æ–±–∞–≤–ª—è–µ–º 18 –Ω—É–ª–µ–π)
                const decimals = await contract.decimals();
                const amountWei = ethers.parseUnits(amount, decimals);

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                const tx = await contract.transfer(recipient, amountWei);
                await tx.wait(); // –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±–ª–æ–∫–∞

                document.getElementById("status").innerText = "Success! Transaction Hash: " + tx.hash;
                
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
                document.getElementById("recipient").value = "";
                document.getElementById("amount").value = "";
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                const address = await signer.getAddress();
                updateBalance(address);

            } catch (error) {
                console.error(error);
                document.getElementById("status").innerText = "Error: " + (error.reason || error.message);
            }
        }

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
        document.getElementById("connectBtn").addEventListener("click", connectWallet);
        document.getElementById("transferBtn").addEventListener("click", transferTokens);
    </script>
</body>
</html>